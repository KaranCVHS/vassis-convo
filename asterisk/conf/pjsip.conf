; =====================================================================================
; ASTERISK PJSIP CONFIGURATION FOR EC2 DEPLOYMENT WITH CHIME
; =====================================================================================

;--------------------------------------------
; TRANSPORT (TCP)
;--------------------------------------------
[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060
external_media_address=54.227.203.106              ; Replace with your EC2 public IP
external_signaling_address=54.227.203.106          ; Replace with your EC2 public IP
external_signaling_port=5060
local_net=172.20.0.0/24                            ; Docker subnet
local_net=172.31.95.0/16                           ; EC2 subnet

;--------------------------------------------
; INTERNAL TEMPLATE
;--------------------------------------------
[endpoint-template](!)
type=endpoint
transport=transport-tcp
disallow=all
allow=gsm
allow=ulaw
context=from-internal
direct_media=no
force_rport=no
rewrite_contact=yes
rtp_symmetric=yes

;--------------------------------------------
; SIP EXTENSION (INTERNAL)
;--------------------------------------------
[1000](endpoint-template)
auth=1000
aors=1000

[1000]
type=auth
auth_type=userpass
password=1000
username=1000

[1000]
type=aor
max_contacts=10

;--------------------------------------------
; CHIME INBOUND ENDPOINT
;--------------------------------------------
[chime-inbound]
type=endpoint
transport=transport-tcp
context=from-chime
disallow=all
allow=ulaw
direct_media=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes
aors=chime-aor

[chime-aor]
type=aor
contact=sip:chime.voiceconnector.placeholder     ; Dummy contact required

[chime-identify]
type=identify
endpoint=chime-inbound
match=52.55.62.0/24
match=52.55.63.0/24
match=3.80.16.0/23
match=3.235.127.128/26
match=172.20.0.1                                     ; Optional internal match for Docker gateway
